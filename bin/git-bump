#!/bin/bash

set -e

CURRENT_TAG="`git tag --sort=v:refname 2>&1 | egrep '^[v]*\d+(?:\.\d+)*' | tail -n 1`"

if [ -z "$CURRENT_TAG" ]; then
    echo "Not at git repository or no semver tag found"
    exit 1
fi

echo "Current Tag: $CURRENT_TAG"

TAG_LEVELS=(${CURRENT_TAG//./ })
DEPTH="${#TAG_LEVELS[@]}"
(( BOTTOM_LEVEL_INDEX=DEPTH-1 ))
BOTTOM_LEVEL="${TAG_LEVELS[BOTTOM_LEVEL_INDEX]}"
echo "Bottom level: $BOTTOM_LEVEL"

foo=('foo bar' 'foo baz' 'bar baz')
bar=$(printf ",%s" "${foo[@]}")
bar=${bar:1}

echo $bar

(( BOTTOM_LEVEL++ ))

TAG_LEVEL[$BOTTOM_LEVEL_INDEX]=$BOTTOM_LEVEL
NEW_TAG=$(printf ".%s" "${TAG_LEVELS[@]}")
NEW_TAG=${NEW_TAG:1}
echo "New Tag: $NEW_TAG"

